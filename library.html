<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Library | SmartQuizzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root { --primary-gold: #FFB300; }
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        
        .sunshine-btn { 
            background: linear-gradient(135deg, #FFD700, #FFB300); 
            color: white; border: none; padding: 10px 25px; 
            border-radius: 50px; font-weight: bold; cursor: pointer; 
            text-decoration: none; display: inline-block;
        }

        .border-top-gold { border-top: 6px solid var(--primary-gold) !important; }
        .glass-card { 
            background: white; border-radius: 20px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.05); 
            transition: transform 0.3s ease;
        }
        .glass-card:hover { transform: translateY(-5px); }
        .hidden-card { display: none !important; }

        /* Modal Custom Fix */
        .modal { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
        .modal-backdrop { display: none !important; }
    </style>
</head>
<body>

<div class="container mt-4 animate__animated animate__fadeIn">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5 gap-3">
        <div>
            <h1 class="fw-bold" style="color: var(--primary-gold);">Your Learning Library ðŸ“š</h1>
            <p class="text-muted">A complete archive of your AI-generated wisdom.</p>
        </div>
        <div class="d-flex gap-2">
            <a href="mcq-list.html" class="btn btn-outline-danger rounded-pill px-4 fw-bold shadow-sm">
                <i class="fa-solid fa-fire me-2"></i>Review Mistakes
            </a>
            <a href="dashboard.html" class="sunshine-btn px-4 shadow-sm text-decoration-none">
                <i class="fa-solid fa-plus me-2"></i>New Session
            </a>
        </div>
    </div>

    <div class="mb-5">
        <div class="position-relative">
            <input type="text" id="librarySearch" class="form-control rounded-pill px-5 py-3 border-2 shadow-sm" 
                   style="border-color: #FFEBB7;" placeholder="Search your questions (e.g. 'Python', 'AI')...">
            <i class="fa-solid fa-magnifying-glass position-absolute" style="left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary-gold);"></i>
        </div>
    </div>

    <div class="row" id="questionGrid">
        <div class="col-12 text-center py-5" id="loader">
            <div class="spinner-border text-warning" role="status"></div>
            <p class="mt-3 text-muted">Opening your archive...</p>
        </div>
    </div>
</div>

<div class="modal fade" id="dynamicInsightModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 25px;">
            <div class="modal-header border-0 px-4 pt-4">
                <h5 class="modal-title fw-bold" style="color: var(--primary-gold);">Question Insight</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body px-4 pb-4">
                <h4 id="modalQuestionText" class="fw-bold mb-4" style="line-height: 1.4; color: #2d3436;"></h4>
                <div class="p-4 rounded-4 shadow-sm" style="background: #FFFDF5; border-left: 6px solid var(--primary-gold);">
                    <h6 class="fw-bold mb-2 text-warning"><i class="fas fa-robot me-2"></i>AI Breakdown</h6>
                    <div id="modalExplanationText" style="max-height: 300px; overflow-y: auto; color: #4a4a4a;"></div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const questionGrid = document.getElementById('questionGrid');
    const loader = document.getElementById('loader');
    
    // 1. Load questions from LocalStorage (Jo Quiz results se save hue honge)
    const savedQuestions = JSON.parse(localStorage.getItem('quiz_questions')) || [];

    if (savedQuestions.length === 0) {
        questionGrid.innerHTML = `
            <div class="col-12 text-center py-5">
                <h3 class="text-muted">Your library is empty.</h3>
                <p>Complete a quiz to see your questions archived here!</p>
            </div>`;
    } else {
        loader.style.display = 'none';
        
        // 2. Generate Cards
        questionGrid.innerHTML = savedQuestions.map((q, index) => `
            <div class="col-md-6 col-lg-4 mb-4 question-card animate__animated animate__fadeInUp">
                <div class="glass-card h-100 d-flex flex-column border-top-gold p-4">
                    <div class="mb-3 d-flex justify-content-between align-items-center">
                        <span class="badge bg-light text-muted border rounded-pill">ID #Q-${index + 1}</span>
                        <span class="text-warning"><i class="fa-solid fa-star"></i></span>
                    </div>
                    
                    <h6 class="fw-bold text-dark mb-4 line-clamp-3" style="min-height: 4.5rem;">
                        ${q.question}
                    </h6>

                    <div class="mt-auto">
                        <button class="sunshine-btn w-100 rounded-pill fw-bold py-2 view-sol-btn" 
                                data-question="${q.question}"
                                data-explanation="${q.explanation || 'Correct Answer: ' + q.correct_answer}">
                            View Solution ðŸ’¡
                        </button>
                    </div>
                </div>
            </div>
        `).join('');

        // 3. Attach Event Listeners to New Buttons
        document.querySelectorAll('.view-sol-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.getElementById('modalQuestionText').innerText = this.getAttribute('data-question');
                document.getElementById('modalExplanationText').innerText = this.getAttribute('data-explanation');
                
                var myModal = new bootstrap.Modal(document.getElementById('dynamicInsightModal'));
                myModal.show();
            });
        });
    }

    // 4. Search logic
    const searchInput = document.getElementById('librarySearch');
    searchInput.addEventListener('input', function() {
        const term = this.value.toLowerCase();
        document.querySelectorAll('.question-card').forEach(card => {
            const text = card.querySelector('h6').innerText.toLowerCase();
            card.classList.toggle('hidden-card', !text.includes(term));
        });
    });
});
</script>
</body>
</html>

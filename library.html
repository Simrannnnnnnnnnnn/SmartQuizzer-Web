{% extends "base.html" %}

{% block content %}
<div class="container mt-4 animate__animated animate__fadeIn">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5 gap-3">
        <div>
            <h1 class="fw-bold" style="color: var(--primary-gold);">Your Learning Library ðŸ“š</h1>
            <p class="text-muted">A complete archive of your AI-generated wisdom.</p>
        </div>
        <div class="d-flex gap-2">
            <a href="#" class="btn btn-outline-danger rounded-pill px-4 fw-bold shadow-sm">
                <i class="fa-solid fa-fire me-2"></i>Review Mistakes
            </a>
            <a href="{{ url_for('routes.dashboard') }}" class="sunshine-btn px-4 shadow-sm text-decoration-none">
                <i class="fa-solid fa-plus me-2"></i>New Session
            </a>
        </div>
    </div>

    <div class="mb-5">
        <div class="position-relative">
            <input type="text" id="librarySearch" class="form-control rounded-pill px-5 py-3 border-2 shadow-sm" 
                   style="border-color: #FFEBB7;" placeholder="Search your questions (e.g. 'Python', 'Plant Cell')...">
            <i class="fa-solid fa-magnifying-glass position-absolute" style="left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary-gold);"></i>
        </div>
    </div>

    <div class="row" id="questionGrid">
        {% for q in questions %}
        <div class="col-md-6 col-lg-4 mb-4 question-card">
            <div class="glass-card h-100 d-flex flex-column transition-hover border-top-gold p-4">
                <div class="mb-3 d-flex justify-content-between align-items-center">
                    <span class="badge bg-light text-muted border rounded-pill">ID #{{ q.id }}</span>
                    <span class="text-warning"><i class="fa-solid fa-star"></i></span>
                </div>
                
                <h6 class="fw-bold text-dark mb-4 line-clamp-3" style="min-height: 4.5rem;">
                    {{ q.question_text }}
                </h6>

                <div class="mt-auto">
                    <button class="sunshine-btn w-100 rounded-pill fw-bold py-2 view-sol-btn" 
                            data-question="{{ q.question_text }}"
                            data-explanation="{{ q.explanation or 'Correct Answer: ' ~ q.correct_answer }}">
                        View Solution ðŸ’¡
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="modal fade" id="dynamicInsightModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 25px;">
            <div class="modal-header border-0 px-4 pt-4">
                <h5 class="modal-title fw-bold" style="color: var(--primary-gold);">Question Insight</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body px-4 pb-4">
                <h4 id="modalQuestionText" class="fw-bold mb-4" style="line-height: 1.4; color: #2d3436;"></h4>
                <div class="p-4 rounded-4 shadow-sm" style="background: #FFFDF5; border-left: 6px solid var(--primary-gold);">
                    <h6 class="fw-bold mb-2 text-warning"><i class="fas fa-robot me-2"></i>AI Breakdown</h6>
                    <div id="modalExplanationText" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<style>
    :root { --primary-gold: #FFB300; }
    .sunshine-btn { background: linear-gradient(135deg, #FFD700, #FFB300); color: white; border: none; padding: 10px 25px; border-radius: 50px; font-weight: bold; cursor: pointer; text-decoration: none; }
    .border-top-gold { border-top: 6px solid var(--primary-gold) !important; }
    .glass-card { background: white; border-radius: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.05); }
    .hidden-card { display: none !important; }

    /* BRAHMASTRA FIX: Isse screen kabhi stuck nahi hogi */
    .modal-backdrop {
        display: none !important; /* Default kaali layer khatam */
    }
    .modal {
        background: rgba(0, 0, 0, 0.5); /* Modal khud hi piche parda banayega */
    }
    body.modal-open {
        overflow: auto !important; /* Body hamesha scrollable rahegi */
        padding-right: 0 !important;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modalEl = document.getElementById('dynamicInsightModal');
    const modalQuestion = document.getElementById('modalQuestionText');
    const modalExpl = document.getElementById('modalExplanationText');
    
    // Simple Modal trigger
    document.querySelectorAll('.view-sol-btn').forEach(button => {
        button.addEventListener('click', function() {
            modalQuestion.innerText = this.getAttribute('data-question');
            modalExpl.innerText = this.getAttribute('data-explanation');
            
            var myModal = new bootstrap.Modal(modalEl);
            myModal.show();
        });
    });

    // Search logic
    const searchInput = document.getElementById('librarySearch');
    searchInput.addEventListener('input', function() {
        const term = this.value.toLowerCase();
        document.querySelectorAll('.question-card').forEach(card => {
            const text = card.querySelector('h6').innerText.toLowerCase();
            card.classList.toggle('hidden-card', !text.includes(term));
        });
    });
});
</script>
{% endblock %}
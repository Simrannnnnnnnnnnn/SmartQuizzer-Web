<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Case Study Challenge | SmartQuizzer</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root { --primary-gold: #FFB300; --brand-midnight: #0f172a; }
        body { background-color: #f1f5f9; font-family: 'Inter', sans-serif; }
        .challenge-card-container { min-height: 550px; }
        .nav-pills .nav-link.active { background-color: white !important; color: black !important; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .hover-up:hover { transform: translateY(-2px); transition: 0.2s; box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; }
        .scenario-box { background: #f0f7ff; border-left: 8px solid #0d6efd; }
        .progress-bar { transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .d-none { display: none !important; }
    </style>
</head>
<body>

<div class="container py-5 animate__animated animate__fadeIn">
    <div class="d-flex justify-content-between align-items-center mb-5 no-print">
        <div class="flex-grow-1 me-4">
            <h5 class="fw-bold mb-1">Challenge Progress</h5>
            <div class="progress" style="height: 12px; border-radius: 10px; background-color: #e2e8f0; border: 1px solid #dee2e6;">
                <div id="challenge-progress" class="progress-bar bg-warning progress-bar-striped progress-bar-animated" style="width: 0%"></div>
            </div>
        </div>
        <div class="text-end">
            <span class="badge bg-dark rounded-pill px-3 py-2">
                Challenge <span id="current-idx-display">1</span> of <span id="total-idx-display">0</span>
            </span>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-9" id="main-content-area">
            </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-9 d-flex justify-content-between align-items-center mt-4 mb-5">
            <button id="prev-btn" class="btn btn-link text-decoration-none text-muted fw-bold" onclick="navigate(-1)">
                <i class="fa-solid fa-chevron-left me-2"></i> Previous
            </button>
            <div id="nav-action-area">
                </div>
        </div>
    </div>
</div>

<script>
    // 1. DATA: Flask cases ko localStorage se fetch karega (ya default use karega)
    let challenges = JSON.parse(localStorage.getItem('generated_cases')) || [
        {
            type: 'case',
            scenario: 'A large tech company is facing a sudden 40% drop in user engagement after a UI update.',
            question: 'What immediate data points should the UX team analyze to identify the friction point?',
            answer: 'Analyze bounce rates on specific pages, heatmaps of the new interface, and user session recordings from the first 24 hours.',
            key_points: ['bounce rates', 'heatmaps', 'session recordings', 'friction']
        },
        {
            type: 'reasoning',
            scenario: 'Logical Reasoning Challenge',
            question: 'If all mammals are warm-blooded and a whale is a mammal, what can you conclude about the whale?',
            answer: 'The whale must be warm-blooded based on deductive reasoning.',
            key_points: ['warm-blooded', 'deductive reasoning', 'mammal']
        }
    ];

    let currentIndex = 0;

    // 2. INITIALIZE
    function init() {
        document.getElementById('total-idx-display').innerText = challenges.length;
        renderChallenge();
    }

    // 3. RENDER FUNCTION
    function renderChallenge() {
        const item = challenges[currentIndex];
        const container = document.getElementById('main-content-area');
        
        container.innerHTML = `
            <div class="card border-0 shadow-lg rounded-4 mb-4 overflow-hidden animate__animated animate__fadeInRight">
                <div class="px-4 py-3 ${item.type === 'case' ? 'bg-primary text-white' : 'bg-warning text-dark'} fw-bold d-flex justify-content-between align-items-center">
                    <span class="text-uppercase tracking-wider">
                        ${item.type === 'case' ? 'üìÅ Case Study' : 'üí° Reasoning Challenge'}
                    </span>
                    <i class="fa-solid ${item.type === 'case' ? 'fa-briefcase' : 'fa-lightbulb'} fa-lg"></i>
                </div>

                <div class="card-body p-4 p-md-5">
                    ${item.type === 'case' ? `
                        <div class="scenario-box p-4 rounded-4 mb-4">
                            <h6 class="text-primary fw-bold text-uppercase small mb-2">The Situation:</h6>
                            <p class="mb-0 fs-5" style="line-height: 1.6; font-style: italic; color: #1e293b;">"${item.scenario}"</p>
                        </div>` : ''}

                    <div class="question-box mb-4">
                        <h3 class="fw-bold text-dark"><span class="text-danger me-2">Q:</span>${item.question}</h3>
                    </div>

                    <div class="interaction-zone">
                        <div class="nav nav-pills mb-4 bg-light p-1 rounded-pill d-inline-flex border">
                            <button class="nav-link active rounded-pill px-4 fw-bold" id="tab-write" onclick="toggleMode('write')">Write Answer ‚úçÔ∏è</button>
                            <button class="nav-link rounded-pill px-4 fw-bold text-dark" id="tab-read" onclick="toggleMode('read')">Reveal üìñ</button>
                        </div>

                        <div id="write-zone">
                            <textarea id="user-ans" class="form-control border-2 rounded-4 p-3 mb-3" rows="5" placeholder="Analyze and provide reasoning..."></textarea>
                            <button class="btn btn-dark w-100 py-3 rounded-pill fw-bold shadow hover-up" onclick="analyzeLogic()">Check My Answer ü™Ñ</button>
                            <div id="result-box" class="mt-4 d-none p-4 rounded-4 animate__animated"></div>
                        </div>

                        <div id="read-zone" class="d-none animate__animated animate__fadeIn">
                            <div class="p-4 rounded-4 border-0" style="background: #f8fafc; border: 1px solid #e2e8f0 !important;">
                                <h6 class="fw-bold text-primary mb-3">Ideal Solution:</h6>
                                <p class="mb-0 text-dark fs-5">${item.answer}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;

        updateNav();
    }

    // 4. NAVIGATION LOGIC
    function navigate(dir) {
        currentIndex += dir;
        renderChallenge();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateNav() {
        // Progress Bar
        const percent = ((currentIndex + 1) / challenges.length) * 100;
        document.getElementById('challenge-progress').style.width = percent + '%';
        document.getElementById('current-idx-display').innerText = currentIndex + 1;

        // Buttons
        document.getElementById('prev-btn').disabled = (currentIndex === 0);
        
        const actionArea = document.getElementById('nav-action-area');
        if (currentIndex === challenges.length - 1) {
            actionArea.innerHTML = `
                <div class="d-flex gap-2">
                    <a href="dashboard.html" class="btn btn-outline-dark rounded-pill px-4 fw-bold">Dashboard</a>
                    <button onclick="finishSession()" class="btn btn-success rounded-pill px-4 fw-bold">Finish Session üèÜ</button>
                </div>`;
        } else {
            actionArea.innerHTML = `<button class="btn btn-warning rounded-pill px-5 py-2 fw-bold" onclick="navigate(1)">Next <i class="fa-solid fa-chevron-right ms-2"></i></button>`;
        }
    }

    // 5. SMART ANALYSIS LOGIC
    function toggleMode(mode) {
        document.getElementById('write-zone').classList.toggle('d-none', mode === 'read');
        document.getElementById('read-zone').classList.toggle('d-none', mode === 'write');
        document.getElementById('tab-write').classList.toggle('active', mode === 'write');
        document.getElementById('tab-read').classList.toggle('active', mode === 'read');
    }

    function analyzeLogic() {
        const input = document.getElementById('user-ans').value.toLowerCase();
        const keys = challenges[currentIndex].key_points;
        const res = document.getElementById('result-box');
        
        if (!input.trim()) { alert("Please type something! ‚úçÔ∏è"); return; }

        let found = keys.filter(k => input.includes(k.toLowerCase()));
        res.classList.remove('d-none', 'animate__fadeInUp', 'animate__shakeX');
        res.style.borderLeft = "8px solid";

        if (found.length === keys.length) {
            res.style.backgroundColor = "#dcfce7"; res.style.borderColor = "#16a34a"; res.style.color = "#166534";
            res.innerHTML = `<h5 class="fw-bold">Perfect Analysis!</h5><p class="mb-0">You captured everything perfectly.</p>`;
        } else if (found.length > 0) {
            res.style.backgroundColor = "#fffbeb"; res.style.borderColor = "#f59e0b"; res.style.color = "#92400e";
            res.innerHTML = `<h5 class="fw-bold">Almost there!</h5><p class="mb-0">You missed: ${keys.filter(x => !found.includes(x)).join(', ')}</p>`;
        } else {
            res.style.backgroundColor = "#fef2f2"; res.style.borderColor = "#ef4444"; res.style.color = "#991b1b";
            res.innerHTML = `<h5 class="fw-bold">Needs more focus...</h5><p class="mb-0">Think about: ${keys.join(', ')}</p>`;
        }
        res.classList.add('animate__fadeInUp');
    }

    function finishSession() {
        alert("Congratulations! Session saved to your Vault.");
        window.location.href = "dashboard.html";
    }

    init();
</script>

</body>
</html>

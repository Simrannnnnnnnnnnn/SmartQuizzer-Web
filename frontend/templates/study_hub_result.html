<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Bundle | SmartQuizzer</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root { --primary-gold: #FFB300; }
        body { background-color: #f8f9fa; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .border-top-gold { border-top: 6px solid var(--primary-gold) !important; }
        .glass-card { border-radius: 24px; border: 1px solid #eee; background: white; }
        .icon-circle { width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .bullet-point { width: 35px; height: 35px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }

        /* 3D Flashcard Effect */
        .flashcard { perspective: 1200px; height: 280px; cursor: pointer; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 24px; box-shadow: 0 8px 25px rgba(0,0,0,0.06); border: 2px solid #000; }
        .flashcard-front { background: white; color: #333; }
        .flashcard-back { background: #FFB300; color: #000; transform: rotateY(180deg); }
        .card-type-tag { font-size: 0.7rem; font-weight: 800; letter-spacing: 1px; padding: 4px 12px; background: #f8f9fa; border-radius: 50px; }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #FFB300; border-radius: 10px; }
        .note-interactive-card:hover { border-color: var(--primary-gold) !important; transform: translateY(-2px); transition: 0.3s; }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<input type="hidden" id="hidden-content">

<div class="container py-5 animate__animated animate__fadeIn">
    <div class="d-flex justify-content-between align-items-center mb-5 no-print">
        <div>
            <h1 class="fw-bold" style="color: #FFB300;">âœ¨ Your AI Study Bundle</h1>
            <p class="text-muted fs-5">Interactive Analysis, Flashcards, and Shorthand Notes.</p>
        </div>
        <div class="d-flex gap-2">
            <button id="gen-btn" onclick="startInteractiveChallenge()" class="btn btn-info text-white rounded-pill px-4 shadow-sm fw-bold">
                <i class="fa-solid fa-brain me-2"></i>Start Case Challenge
            </button>
            <button onclick="window.print()" class="btn btn-outline-dark rounded-pill px-4 shadow-sm border-2">
                <i class="fa-solid fa-file-pdf me-2"></i>Export PDF
            </button>
            <a href="study_hub.html" class="btn btn-warning text-white rounded-pill px-4 shadow-sm fw-bold">
                <i class="fa-solid fa-plus me-2"></i>New Topic
            </a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-7">
            <div class="glass-card p-4 mb-4 border-top-gold shadow-sm bg-white border-2">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold m-0"><i class="fa-solid fa-feather-pointed text-warning me-2"></i>Shorthand Notes</h4>
                    <span class="badge bg-light text-muted border rounded-pill">Click for quick revision</span>
                </div>
                
                <div id="shorthand-list" class="list-group list-group-flush">
                    <div class="text-center p-4"><div class="spinner-border text-warning"></div></div>
                </div>
            </div>

            <div class="glass-card p-4 shadow-sm mb-4 border-0 position-relative overflow-hidden border-2" style="background: #FFF9E6;">
                <h4 class="fw-bold mb-3"><i class="fa-solid fa-lightbulb text-warning me-2"></i>Memory Palace Story</h4>
                <div class="mnemonic-box p-4 bg-white rounded-4 border-start border-warning border-5 shadow-sm">
                    <p id="mnemonic-text" class="mb-0 text-dark fw-bold" style="font-size: 1.1rem; line-height: 1.8; font-style: italic;">
                        Generating your story...
                    </p>
                </div>
            </div>
            
            <div class="glass-card p-4 shadow-sm border-0 mb-4 bg-dark text-white no-print">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle bg-warning text-dark me-3">
                            <i class="fa-solid fa-rocket"></i>
                        </div>
                        <div>
                            <h5 class="fw-bold mb-0">Mastered the concepts?</h5>
                            <p class="small mb-0 text-white-50">Test your knowledge with AI Quiz.</p>
                        </div>
                    </div>
                    <button onclick="startQuiz()" class="btn btn-warning rounded-pill fw-bold px-4 text-dark">Start Quiz</button>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="sticky-top" style="top: 20px;">
                <h4 class="fw-bold mb-4"><i class="fa-solid fa-layer-group text-primary me-2"></i>Active Recall</h4>
                <div id="flashcard-list" class="flashcard-stack custom-scrollbar pe-2" style="max-height: 85vh; overflow-y: auto;">
                    <div class="text-center p-4"><div class="spinner-border text-primary"></div></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Configuration
    const BACKEND_URL = "https://simrankaurrrrrr-smartquizzer-backend.hf.space";

    // 1. Data Loading on Page Load
    document.addEventListener('DOMContentLoaded', function() {
        const data = JSON.parse(localStorage.getItem('currentStudyData'));
        
        if (!data) {
            alert("No data found! Redirecting to Study Hub...");
            window.location.href = "study_hub.html";
            return;
        }

        // Fill Hidden Content
        document.getElementById('hidden-content').value = data.detailed_revision;

        // Render Shorthand Notes
        const shorthandContainer = document.getElementById('shorthand-list');
        shorthandContainer.innerHTML = data.shorthand_notes.map(note => `
            <div class="list-group-item bg-transparent border-0 mb-3 px-0">
                <div class="note-interactive-card p-3 rounded-4 border shadow-sm transition-all bg-white">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="d-flex align-items-start flex-grow-1" style="cursor: pointer;" onclick="toggleDetail(this)">
                            <div class="bullet-point bg-warning bg-opacity-10 text-warning rounded-circle me-3 mt-1">
                                <i class="fa-solid fa-bolt-lightning p-2"></i>
                            </div>
                            <span class="fs-6 fw-bold text-dark mt-1">${note}</span>
                        </div>
                        <div class="d-flex gap-2 no-print">
                            <button class="btn btn-sm btn-outline-dark rounded-pill px-3 fw-bold shadow-sm" onclick="deepDive(this, '${note}')">
                                ðŸš€ Deep Dive
                            </button>
                        </div>
                    </div>
                    <div class="note-detail-content d-none mt-3 pt-3 border-top animate__animated animate__fadeIn"></div>
                </div>
            </div>
        `).join('');

        // Render Mnemonic
        document.getElementById('mnemonic-text').innerText = `"${data.mnemonic_story}"`;

        // Render Flashcards
        const flashcardContainer = document.getElementById('flashcard-list');
        flashcardContainer.innerHTML = data.flashcards.map(card => `
            <div class="flashcard mb-4" onclick="this.classList.toggle('flipped')">
                <div class="flashcard-inner">
                    <div class="flashcard-front d-flex flex-column align-items-center justify-content-center p-4">
                        <div class="card-type-tag mb-3 border">QUESTION</div>
                        <h5 class="fw-bold text-center px-3 text-dark">${card.front || card.question}</h5>
                        <div class="mt-auto text-muted small fw-bold"><i class="fa-solid fa-hand-pointer me-2"></i>Flip for Answer</div>
                    </div>
                    <div class="flashcard-back d-flex flex-column align-items-center justify-content-center p-4">
                        <div class="card-type-tag bg-white text-dark mb-3 border">ANSWER</div>
                        <p class="text-center fs-6 fw-bold text-dark">${card.back || card.answer}</p>
                        <div class="mt-auto"><i class="fa-solid fa-check-double text-dark"></i></div>
                    </div>
                </div>
            </div>
        `).join('');
    });

    // 2. Toggle View
    function toggleDetail(element) {
        const card = element.closest('.note-interactive-card');
        const detailDiv = card.querySelector('.note-detail-content');
        detailDiv.classList.toggle('d-none');
    }

    // 3. Deep Dive (API Call)
    async function deepDive(btn, text) {
        if (window.event) window.event.stopPropagation();
        const card = btn.closest('.note-interactive-card');
        const detailDiv = card.querySelector('.note-detail-content');
        detailDiv.classList.remove('d-none');
        detailDiv.innerHTML = '<div class="p-3 text-center"><div class="spinner-border spinner-border-sm text-warning"></div> Analyzing...</div>';
        
        try {
            const response = await fetch(`${BACKEND_URL}/deep-dive`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ concept: text })
            });
            const result = await response.json();
            detailDiv.innerHTML = `
                <div class="p-4 rounded-4 animate__animated animate__fadeIn" style="background: #f8fafc; border: 1px solid #e2e8f0; border-left: 5px solid #0f172a;">
                    <strong class="d-block mb-2 text-dark"><i class="fa-solid fa-microchip me-2 text-primary"></i>Advanced Analysis:</strong>
                    <div class="text-dark" style="font-size: 0.95rem; line-height:1.7; white-space: pre-wrap;">${result.analysis}</div>
                </div>`;
        } catch (e) {
            detailDiv.innerHTML = `<div class="p-3 text-danger">Deep Dive failed. Try again.</div>`;
        }
    }

    // 4. Case Challenge
    async function startInteractiveChallenge() {
        const btn = document.getElementById('gen-btn');
        const content = document.getElementById('hidden-content').value;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>AI Generating...';
        btn.disabled = true;

        try {
            const response = await fetch(`${BACKEND_URL}/start-challenge`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content_to_study: content })
            });
            const result = await response.json();
            if (result.success) {
                localStorage.setItem('challenge_data', JSON.stringify(result.data));
                window.location.href = "case_challenge.html";
            }
        } catch (e) {
            alert("Connection error!");
            btn.innerHTML = '<i class="fa-solid fa-brain me-2"></i>Start Case Challenge';
            btn.disabled = false;
        }
    }

    // 5. Quiz Logic
    function startQuiz() {
        const data = JSON.parse(localStorage.getItem('currentStudyData'));
        // Yahan aap quiz page par redirect kar sakte hain logic ke sath
        alert("Redirecting to AI Quiz based on your notes...");
    }
</script>
</body>
</html>

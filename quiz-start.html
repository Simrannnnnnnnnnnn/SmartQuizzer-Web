<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Quiz | SmartQuizzer</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root { 
            --brand-midnight: #0f172a; 
            --brand-accent: #FFB300; 
            --text-muted: #64748b;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; }
        .quiz-container-wrapper {
            background: linear-gradient(180deg, var(--brand-midnight) 0%, #1e293b 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-glass-card {
            background: white;
            max-width: 700px;
            width: 100%;
            text-align: center;
            padding: 60px 40px;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .stat-card {
            padding: 20px;
            border-radius: 20px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            transition: 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--brand-accent); }
        .btn-main {
            background: var(--brand-accent);
            color: var(--brand-midnight);
            text-decoration: none;
            padding: 20px 60px;
            font-size: 1.3rem;
            font-weight: 800;
            border-radius: 20px;
            display: inline-block;
            border: none;
            transition: 0.3s;
            box-shadow: 0 10px 20px rgba(255, 179, 0, 0.3);
        }
        .btn-main:hover {
            transform: scale(1.05);
            background: #ffa000;
            color: var(--brand-midnight);
        }
        .btn-main:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; box-shadow: none; }
    </style>
</head>
<body>

<div class="quiz-container-wrapper">
    <div class="auth-glass-card animate__animated animate__zoomIn">
        <div style="background: var(--brand-accent); color: var(--brand-midnight); display: inline-block; padding: 8px 25px; border-radius: 50px; margin-bottom: 30px; font-weight: 800; font-size: 0.75rem; letter-spacing: 2px;">
            READY TO START
        </div>
        
        <h1 id="topic-title" style="font-size: 3rem; margin-bottom: 15px; color: var(--brand-midnight); font-weight: 800;">
            Loading Topic...
        </h1>
        <p style="color: var(--text-muted); font-size: 1.1rem; margin-bottom: 40px; font-weight: 600;">
            Challenge yourself. You have <span style="color: var(--brand-midnight); font-weight: 800;">30 seconds</span> per question.
        </p>
        
        <div class="row g-3 mb-5">
            <div class="col-4">
                <div class="stat-card">
                    <p style="font-size: 0.7rem; font-weight: 800; margin-bottom: 5px; color: var(--text-muted); text-transform: uppercase;">Questions</p>
                    <h4 style="font-size: 1.5rem; margin: 0; font-weight: 800;">10</h4>
                </div>
            </div>
            <div class="col-4">
                <div class="stat-card">
                    <p style="font-size: 0.7rem; font-weight: 800; margin-bottom: 5px; color: var(--text-muted); text-transform: uppercase;">Level</p>
                    <h4 style="font-size: 1.5rem; margin: 0; font-weight: 800;">Adaptive</h4>
                </div>
            </div>
            <div class="col-4">
                <div class="stat-card">
                    <p style="font-size: 0.7rem; font-weight: 800; margin-bottom: 5px; color: var(--text-muted); text-transform: uppercase;">Type</p>
                    <h4 style="font-size: 1.5rem; margin: 0; font-weight: 800;">MCQ</h4>
                </div>
            </div>
        </div>

        <button id="start-btn" class="btn-main">
            <span id="btn-text">Begin Assessment</span>
            <div id="loader" class="spinner-border spinner-border-sm ms-2 d-none"></div>
        </button>
        
        <p id="error-msg" class="text-danger mt-3 d-none small fw-bold"></p>
    </div>
</div>

<script>
    // 1. Get Topic from URL or Storage
    const selectedTopic = localStorage.getItem('selected_topic') || "General AI";
    document.getElementById('topic-title').innerText = selectedTopic + " Quiz";

    const startBtn = document.getElementById('start-btn');
    const btnText = document.getElementById('btn-text');
    const loader = document.getElementById('loader');
    const errorMsg = document.getElementById('error-msg');

    startBtn.onclick = async () => {
        // UI State: Loading
        startBtn.disabled = true;
        btnText.innerText = "Generating Questions...";
        loader.classList.remove('d-none');
        errorMsg.classList.add('d-none');

        try {
            // 2. Fetch Questions from Hugging Face Backend
            const response = await fetch('https://simrankaurrrrrr-smartquizzer-backend.hf.space/generate-quiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    topic: selectedTopic,
                    num_questions: 10 
                })
            });

            const data = await response.json();

            if (data.success && data.questions.length > 0) {
                // 3. Save Questions and Reset State
                localStorage.setItem('quiz_questions', JSON.stringify(data.questions));
                localStorage.setItem('current_q_index', 0);
                localStorage.setItem('user_answers_pool', JSON.stringify([]));
                localStorage.setItem('quiz_topic', selectedTopic);
                
                // 4. Redirect to Live Quiz Page
                window.location.href = "quiz.html";
            } else {
                throw new Error(data.message || "Failed to generate questions");
            }

        } catch (err) {
            console.error(err);
            errorMsg.innerText = "Error: Backend is sleeping or busy. Try again.";
            errorMsg.classList.remove('d-none');
            startBtn.disabled = false;
            btnText.innerText = "Begin Assessment";
            loader.classList.add('d-none');
        }
    };
</script>

</body>
</html>
